<!DOCTYPE html>
<html lang="fr">
<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infos Syst√®me</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <h1 class="text-center mb-4">Informations du Syst√®me</h1>
        
        <div class="row">
            <div class="col-md-6">
                <ul class="list-group">
                    <li class="list-group-item"><strong>Nom d'h√¥te :</strong> {{ info.hostname }}</li>
                    <li class="list-group-item"><strong>Adresse IP :</strong> {{ info.ip }}</li>
                    <li class="list-group-item"><strong>OS :</strong> {{ info.os }}</li>
                </ul>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-4"><canvas id="cpuChart"></canvas></div>
            <div class="col-md-4"><canvas id="ramChart"></canvas></div>
            <div class="col-md-4"><canvas id="diskChart"></canvas></div>
        </div>                         
        </div>
    </div>
    <script>
        function updateCharts() {
            fetch('/update_data')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('cpu_chart').innerHTML = data.cpu_chart;
                    document.getElementById('ram_chart').innerHTML = data.ram_chart;
                    document.getElementById('disk_chart').innerHTML = data.disk_chart;
                })
                .catch(error => console.error('Erreur lors du rafra√Æchissement:', error));
        }
    
        setInterval(updateCharts, 5000);  // Rafra√Æchit toutes les 5 secondes
    </script>
    <script>
        function drawCharts(data) {
            Plotly.react("cpu_chart", [data.cpu], { title: "Utilisation CPU (%)" });
            Plotly.react("ram_chart", [data.ram], { title: "Utilisation RAM (%)" });
            Plotly.react("disk_chart", [data.disk], { title: "Utilisation Stockage (%)" });
        }
    
        function updateCharts() {
            fetch('/update_data')
                .then(response => response.json())
                .then(data => {
                    drawCharts(data);
                })
                .catch(error => console.error('Erreur lors du rafra√Æchissement:', error));
        }
    
        // Charger les graphiques au d√©marrage
        updateCharts();
    
        // Rafra√Æchir toutes les 5 secondes
        setInterval(updateCharts, 5000);
    </script>    
</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let ctxCpu = document.getElementById('cpuChart').getContext('2d');
    let ctxRam = document.getElementById('ramChart').getContext('2d');
    let ctxDisk = document.getElementById('diskChart').getContext('2d');

    let cpuChart = new Chart(ctxCpu, {
        type: 'doughnut',
        data: { labels: ['Utilis√©', 'Libre'], datasets: [{ data: [0, 100], backgroundColor: ['#ff4d4d', '#cccccc'] }] },
        options: { responsive: true, maintainAspectRatio: false }
    });

    let ramChart = new Chart(ctxRam, {
        type: 'doughnut',
        data: { labels: ['Utilis√©', 'Libre'], datasets: [{ data: [0, 100], backgroundColor: ['#4d79ff', '#cccccc'] }] },
        options: { responsive: true, maintainAspectRatio: false }
    });

    let diskChart = new Chart(ctxDisk, {
        type: 'doughnut',
        data: { labels: ['Utilis√©', 'Libre'], datasets: [{ data: [0, 100], backgroundColor: ['#4dff4d', '#cccccc'] }] },
        options: { responsive: true, maintainAspectRatio: false }
    });

    function updateCharts() {
        fetch('/update_data')
        .then(response => response.json())
        .then(data => {
            console.log("üîπ Donn√©es re√ßues :", data); // DEBUG : V√©rifie les donn√©es

            // Mise √† jour des graphiques
            cpuChart.data.datasets[0].data = [data.cpu, 100 - data.cpu];
            ramChart.data.datasets[0].data = [data.ram, 100 - data.ram];
            diskChart.data.datasets[0].data = [data.disk, 100 - data.disk];

            cpuChart.update();
            ramChart.update();
            diskChart.update();
        })
        .catch(error => console.error('Erreur de mise √† jour :', error));
    }

    // Rafra√Æchir toutes les 5 secondes
    setInterval(updateCharts, 5000);
    updateCharts();  // Met √† jour imm√©diatement au chargement
</script>
</html>
