<!DOCTYPE html>
<html lang="fr">
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infos Syst√®me</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* Emp√™che l'agrandissement infini des graphes */
        .chart-container {
            width: 100%;
            height: 250px; /* Hauteur fixe */
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
    <style>
        /* Mode clair (par d√©faut) */
        body {
            background-color: #f8f9fa;
            color: #212529;
        }
        .dark-mode {
            background-color: #212529 !important;
            color: #f8f9fa !important;
        }
        .dark-mode .list-group-item {
            background-color: #343a40 !important;
            color: #f8f9fa !important;
            border-color: #454d55;
        }
        .dark-mode .card {
            background-color: #343a40 !important;
            color: #f8f9fa !important;
            border-color: #454d55;
        }
        .toggle-container {
            text-align: right;
            margin-bottom: 10px;
        }
    </style>    
</head>
<body class="bg-light">
    <div class="container mt-4">
        <h1 class="text-center mb-4">Informations du Syst√®me</h1>
        <div class="toggle-container">
            <button id="toggleDarkMode" class="btn btn-dark">üåô Mode sombre</button>
        </div>        
        <div class="row">
            <div class="col-md-6">
                <ul class="list-group">
                    <li class="list-group-item"><strong>Nom d'h√¥te :</strong> {{ info.hostname }}</li>
                    <li class="list-group-item"><strong>Adresse IP :</strong> {{ info.ip }}</li>
                    <li class="list-group-item"><strong>OS :</strong> {{ info.os }}</li>
                </ul>
            </div>
        </div>

        <!-- Conteneur des graphiques -->
        <div class="row text-center mt-4">
            <div class="col-md-4">
                <h4>Utilisation CPU</h4>
                <div class="chart-container">
                    <canvas id="cpuChart"></canvas>
                </div>
            </div>
            <div class="col-md-4">
                <h4>Utilisation RAM</h4>
                <div class="chart-container">
                    <canvas id="ramChart"></canvas>
                </div>
            </div>
            <div class="col-md-4">
                <h4>Utilisation Stockage</h4>
                <div class="chart-container">
                    <canvas id="diskChart"></canvas>
                </div>
            </div>
        </div>                         
    </div>

    <script>
        // Initialisation des graphiques avec Chart.js
        let cpuChart = new Chart(document.getElementById('cpuChart').getContext('2d'), {
            type: 'doughnut',
            data: { labels: ['Utilis√©', 'Libre'], datasets: [{ data: [0, 100], backgroundColor: ['#ff4d4d', '#cccccc'] }] },
            options: { responsive: true, maintainAspectRatio: true }
        });

        let ramChart = new Chart(document.getElementById('ramChart').getContext('2d'), {
            type: 'doughnut',
            data: { labels: ['Utilis√©', 'Libre'], datasets: [{ data: [0, 100], backgroundColor: ['#4d79ff', '#cccccc'] }] },
            options: { responsive: true, maintainAspectRatio: true }
        });

        let diskChart = new Chart(document.getElementById('diskChart').getContext('2d'), {
            type: 'doughnut',
            data: { labels: ['Utilis√©', 'Libre'], datasets: [{ data: [0, 100], backgroundColor: ['#4dff4d', '#cccccc'] }] },
            options: { responsive: true, maintainAspectRatio: true }
        });

        // Fonction de mise √† jour des graphiques
        function updateCharts() {
            fetch('/update_data')
            .then(response => response.json())
            .then(data => {
                console.log("üîπ Donn√©es re√ßues :", data); // DEBUG

                cpuChart.data.datasets[0].data = [data.cpu, 100 - data.cpu];
                ramChart.data.datasets[0].data = [data.ram, 100 - data.ram];
                diskChart.data.datasets[0].data = [data.disk, 100 - data.disk];

                cpuChart.update();
                ramChart.update();
                diskChart.update();
            })
            .catch(error => console.error('‚ùå Erreur de mise √† jour :', error));
        }

        // Rafra√Æchir toutes les 5 secondes
        setInterval(updateCharts, 5000);
        updateCharts();  // Mise √† jour imm√©diate au chargement
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const toggleButton = document.getElementById("toggleDarkMode");
            const body = document.body;
    
            // V√©rifier si un mode est enregistr√© dans localStorage
            if (localStorage.getItem("darkMode") === "enabled") {
                body.classList.add("dark-mode");
                toggleButton.textContent = "‚òÄÔ∏è Mode clair";
                toggleButton.classList.replace("btn-dark", "btn-light");
            }
    
            // Gestion du clic sur le bouton
            toggleButton.addEventListener("click", function () {
                body.classList.toggle("dark-mode");
    
                if (body.classList.contains("dark-mode")) {
                    localStorage.setItem("darkMode", "enabled");
                    toggleButton.textContent = "‚òÄÔ∏è Mode clair";
                    toggleButton.classList.replace("btn-dark", "btn-light");
                } else {
                    localStorage.setItem("darkMode", "disabled");
                    toggleButton.textContent = "üåô Mode sombre";
                    toggleButton.classList.replace("btn-light", "btn-dark");
                }
            });
        });
    </script>    
</body>
</html>
